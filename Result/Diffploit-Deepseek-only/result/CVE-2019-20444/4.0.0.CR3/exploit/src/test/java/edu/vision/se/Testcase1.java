package edu.vision.se;

import io.netty.buffer.Unpooled;
import io.netty.channel.ChannelHandlerContext;
import io.netty.channel.ChannelInboundHandlerAdapter;
import io.netty.channel.embedded.EmbeddedByteChannel;
import io.netty.handler.codec.http.HttpMessage;
import io.netty.handler.codec.http.HttpRequest;
import io.netty.handler.codec.http.HttpRequestDecoder;
import io.netty.util.CharsetUtil;
import org.junit.Test;

import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertTrue;

public class Testcase1 {

    @Test(timeout = 60000)
    public void testHeaderWithNoValueAndMissingColon() {
        EmbeddedByteChannel channel = new EmbeddedByteChannel(new HttpRequestDecoder());
        String requestStr = "GET /some/path HTTP/1.1\r\n" +
                "Content-Length: 0\r\n" +
                "Host:\r\n" +
                "netty.io\r\n\r\n";
        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(requestStr, CharsetUtil.US_ASCII)));
        HttpRequest request = (HttpRequest) channel.readInbound();
        assertTrue(request.getDecoderResult().isFailure());
        assertTrue(request.getDecoderResult().cause() instanceof IllegalArgumentException);
        assertFalse(channel.finish());
    }
}
