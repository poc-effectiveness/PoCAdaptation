package edu.vision.se;

import static org.junit.Assert.assertTrue;

import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;

import org.apache.dolphinscheduler.api.service.ResourcesService;
import org.apache.dolphinscheduler.api.utils.Result;
import org.apache.dolphinscheduler.common.enums.ResourceType;
import org.apache.dolphinscheduler.dao.entity.User;
import org.junit.Test;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.transaction.annotation.Transactional;

public class Testcase1 {
    @Test
    public void testDirectoryTraversal()
            throws IllegalAccessException, IllegalArgumentException, InvocationTargetException, NoSuchMethodException,
            SecurityException {
        ResourcesService res = new ResourcesService();
        Method method_verifyFile = res.getClass().getDeclaredMethod("updateResource", User.class, int.class, String.class,
                String.class, ResourceType.class, MultipartFile.class);
        method_verifyFile.setAccessible(true);
        Object result = method_verifyFile.invoke(res, null, 0, "../../abc.txt", "", null, null);
        validateReturnValue(result);
    }

    public void validateReturnValue(Object result) {
        assertTrue((result instanceof Result)
                && ((Result) result).getCode() == 1300009);
    }
}
