package edu.vision.se;

import com.fasterxml.jackson.dataformat.xml.XmlMapper;
import java.util.Map;
import static org.junit.Assert.fail;
import org.junit.Test;
import org.junit.BeforeClass;

public class Testcase1 {

    @BeforeClass
    public static void setUp() throws Exception {
        // Start a simple HTTP server that will refuse connections
        try {
            Runtime.getRuntime().exec("python -m http.server 8001");
            // Give the server a moment to start
            Thread.sleep(1000);
        } catch (Exception e) {
            // Ignore
        }
    }

    @Test(timeout = 5000)
    public void testDTDAttempt() throws Exception {
        XmlMapper mapper = new XmlMapper();
        String XML = "<?xml version='1.0' encoding='UTF-8'?><!DOCTYPE foo SYSTEM 'http://127.0.0.1:8001' [ ]>\n"
                + "<foo/>";

        try {
            /* Map<String, String> info = */ mapper.readValue(XML, Map.class);
            // At this point a GET request would have been sent to localhost:8001. You will
            // see a Connection Refused in case you don't have a server listening there.
        } catch (Exception e) {
            fail("Should not try to resolve external DTD subset: " + e);
        }
    }
}
